# 開発パート07: ステータスアップアイテムを実装する

ラスボスダンジョンを作成し、エンディングを迎えることができるようになりましたが、まだまだゲームとしては未完成と言えます。  
ラスボスのステータスを強力にして、簡単にはクリアできないようにしたうえで、様々な要素を組み合わせて戦うことができるようにしていきます。  

まずは、キャラクターの特定の能力を向上させるアイテムを実装していきます。

このパートで実装すべき機能は、以下の通りです。

1. 抽象クラスとして、Item クラスを作成する
2. Item クラスのサブクラスとして、ステータスアップアイテムを作成する
3. 味方キャラクター一覧クラスのメンバ変数に、所持アイテムを設定できるリストを作成する
4. 敵キャラクターを倒した際に、一定確率でステータスアップアイテムを獲得する処理を追加
5. 戦闘終了後のコマンド選択で、所持アイテム使用するコマンドを追加する

順番に実装方法を確認していきます。

## 1. 抽象クラスとして、Item クラスを作成する

将来的にステータスアップ以外の効果を持っているアイテムを実装できるように、まずは、アイテムの基本となる情報を持った抽象クラスとして、Item クラスを作成しましょう。

Item クラスで作成するべきメンバ変数は以下です。

| 項目名 | 型 | 備考
| --- | --- | ---
| 名前 | string | アイテムの名前を設定する
| 説明 | string | アイテムの効果の説明文

また、クラス変数は以下のように定義します。

| クラス変数名 | 型 | 備考
| --- | --- | ---
| 最大所持数 | int | アイテムの最大所持数。クラス変数として定義する

Item では、最大所持数を設定する必要があります。  
最大所持数はアイテムの種類ごとに設定されるべきものなので、メンバ変数ではなくクラス変数として定義します。

:::info
クラス変数とは、オブジェクトを作成しなくても利用できる変数のことです。  
クラス変数は、クラス名.変数名 という形でアクセスします。

```python
Item.MAX_ITEM_NUM
```

クラス変数は便利ですが、値を様々なところから変更できてしまうため、利用には注意が必要です。

:::

Item クラスは、以下のメソッドを持ちます。

| 項目名 | 引数 | 返り値の型 | 備考
| --- | --- | --- | ---
| 使用する | None | None | アイテムの効果を発動する。抽象メソッドとして定義する
| コンストラクタ | 各メンバ変数の値 | None | メンバ変数の値と、アイテムの名前を設定する

抽象クラスと抽象メソッドの作成方法は、各自調べてみてください。

## 2. Item クラスのサブクラスとして、ステータスアップアイテムを作成する

Item クラスを継承して、ステータスアップ用のアイテムのクラスを作成していきます。

攻撃力アップ用、防御力アップ用、最大体力アップ用、複数のステータスを同時にアップさせるもの、または攻撃力をあげる代わりに防御力を下げるもの…など、いくつかの種類を用意してみましょう。

ステータスアップ用アイテムには、以下のメソッドを作成します。

| 項目名 | 引数 | 返り値の型 | 備考
| --- | --- | --- | ---
| 使用する | MyMonster | None | 対象のキャラクターを選択させ、ステータスを上昇させる。

## 3. 所持しているアイテムを表すクラスを作成する

次に、キャラクターたちが所持しているアイテムを表すためのクラスを作成します。  

以下のようなクラスを作成しましょう。

| 項目名 | 型 | 備考
| --- | --- | ---
| アイテム | Item | アイテムのオブジェクト
| 所持数 | int | アイテムの所持数

アイテムオブジェクトと、その所持数をメンバ変数として設定することで、「所持しているアイテム」を表現します。

また、所持数を操作しやすくするために、いくつかのメソッドを作成します。

| 項目名 | 引数 | 返り値の型 | 備考
| --- | --- | --- | ---
| 所持数を増やす | int | None | アイテムの最大所持数を超える場合は増やさない
| 所持数を減らす | int | None | アイテムの所持数が0未満になる場合は減らさない

さらに、アイテムは味方キャラクターたちが使うものなので、味方キャラクター一覧のメンバ変数として所持アイテムオブジェクトのリストを追加しましょう。

味方キャラクター一覧のクラスに追加設定すべきメンバ変数は、以下の通りです。

| 項目名 | 型 | 備考
| --- | --- | ---
| 所持アイテム一覧 | list[所持アイテム] | 味方キャラクターが所持しているアイテムの一覧

所持アイテムのリストを持つようにすることで、持っているアイテムを一つのリストに対する操作として扱うことができます。

所有アイテムの増減は、味方キャラクター一覧のクラスにメソッドを追加して行えるようにしましょう。
味方キャラクター一覧のクラスに追加設定すべきメソッドは、以下の通りです。

| 項目名 | 引数 | 返り値の型 | 備考
| --- | --- | --- | ---
| アイテムを追加 | Item クラスを継承したオブジェクト | None | アイテムの所持数を増やす
| アイテムを減らす | Item クラスを継承したオブジェクト | None | アイテムの所持数を減らす。所持数が0になった場合、リストから削除する

:::info
味方キャラクター一覧のクラスのメソッドのアイテム数増減では、所持アイテムクラスのメソッドを呼び出すようにします。
このように、あるオブジェクトがメンバ変数として別のオブジェクトを持ったり、そのメンバ変数のメソッドを呼び出すなど、オブジェクトを組み合わせて大きなシステムを組み上げていきます。
:::

## 4. 敵キャラクターを倒した際に、一定確率でステータスアップアイテムを獲得する処理を追加

次に、敵キャラクターを倒した（体力を0にした）際に、アイテムを獲得する処理を追加しましょう。
味方モンスターの一覧のオブジェクトにアイテムを追加する際の処理は、以下のようになります。  

1. 乱数によりアイテムを獲得できたかを判定、獲得の場合はそのアイテムのオブジェクトを生成する  
2. 所持アイテムのリストに、すでにアイテムがあるかを判定する  
3. リストの中に、今回獲得した種類のアイテムがない場合、リストに追加する  
4. すでにリストにアイテムがある場合、その所持アイテムの所持数の値を追加する  

獲得確率は、各自で調整してみてください。

この部分では、listの応用的な操作が必要になります。ひとつずつ挙動を確認しながら進めてみてください。

## 5. 戦闘終了後のコマンド選択で、所持アイテムを使用するコマンドを追加する

コマンド選択に、「アイテム使用」を追加していきます。追加するべき処理は、以下のようになります。

1. 選択するコマンドに、「アイテム使用」を追加する
2. アイテム使用のコマンド番号を入力された場合、使用できるアイテムの一覧を表示し、その中から利用するアイテムを選択する
3. アイテムが選択されたら、次はどのキャラクターに利用するかを選択させる
4. アイテムの効果を発生させ、対象キャラクターのステータスを変化させる
5. アイテムの所持数を減少させる。所持数が0になった場合、所持アイテムのリストから要素を削除する

:::info
Item クラスのメソッドとして「使用する」を実装する場合、どの味方キャラクターを対象に選ぶかの実装は、少し難しい部分です。  
「使用する」メソッドから味方キャラクターの情報にアクセスする方法を考える必要があります。  
やり方はいくつかあります。例としては、引数として味方キャラクターの一覧を渡したり、キャラクター一覧のリストをクラス変数に変更して、アイテム選択の場面からもアクセスできるようにする、といった方法が考えられます。  
それぞれにメリット・デメリットがあるので、ぜひ工夫してみてください。
:::

## 6. 動作の確認

アイテムの追加、使用ができるようになったら、動作に問題がないかを確かめていきます。  
すくなくとも、以下のパターンでエラーが起こらないことを確認してください。

:white_check_mark: アイテム使用時に変更したステータスが、きちんと反映されているか  
:white_check_mark: アイテムの最大所持数を超えたときの動作に不都合がないか  
:white_check_mark: アイテム使用の機能を使った後、戦闘を開始して正しく動作できるか  

## 7. 余裕のある人向けの追加ミッション　アイテムを複数個、まとめて使用する

例えば、攻撃力アップアイテムを3個持っているとします。  
このとき、3回アイテム使用の操作をするのではなく、1回の使用で3個のアイテムを使用できるようにしてみてください。
