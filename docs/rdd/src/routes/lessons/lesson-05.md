# 開発パート05: レベルアップ機能を追加する

パート04 までで、複数のキャラクター同士で戦闘を繰り返し、敗北したらゲームオーバーになる、というプログラムを作成することができました。

パート5以降は、いろいろな機能を追加で作成していき、もっと面白いゲームに仕上げていきます！
まずは、RPGゲームの定番であるレベルアップ機能を実装していきましょう。

レベルアップ機能を実現するために必要な動作は、以下に分解できます。

1. キャラクターごとに、自分のレベル数値を管理すること
2. キャラクターごとに、自分の経験値の数値を管理すること
3. 経験値を獲得するメソッドを実装すること
4. レベルアップするメソッドを作成し、ステータスを上昇させること
5. 経験値が一定にたまったら、レベルアップするメソッドを実行すること

これを順番に実装していきます。

## 1. 味方キャラクターの一覧をクラス化する

パート03 で作成した味方キャラクターの一覧を、クラスとして作成しましょう。  
レベルアップの機能を味方キャラクターのクラスMyMonster にだけ設定するので、味方キャラクターの一覧のクラスには、メンバ変数としてMyMonster のリストを作成します。クラス名は、各自で設定してください。  

味方キャラクター一覧のクラスに設定すべきメンバ変数は、以下の通りです。

| 項目名 | 型 | 備考
| --- | --- | ---
| 味方キャラ一覧 | list[MyMonster] | MyMonster オブジェクトを要素に持つリスト。

## 2. Monster クラスのメンバ変数に、レベルを追加する

味方キャラクター一覧のクラスを作成したら、次はMonster クラスにレベル数値を管理するためのメンバ変数を作っていきます。  
レベルのメンバ変数を追加しただけだと、Monster オブジェクトを作成した際にレベルの値を指定できません。  
MyMonsterおよびEnemyMonster クラスのコンストラクタを修正して、レベルが設定できるようにしましょう。  

## 3. MyMonster クラスのメンバ変数に、経験値を追加する

レベルが追加できたら、次はMyMonster クラスを編集していきます。  
レベルを上昇させるための経験値のメンバ変数を作りましょう。

オブジェクト生成時には経験値の値は0になっているのが一般的なので、コンストラクタでは経験値の初期値は0にしておきます。  

:::info
以降は、MyMonster とEnemyMonster の設定内容が異なる部分が増えていきます。  
単純にMonster オブジェクトとして処理を作ると、うまく動作させられなくなる部分が出てくるはずです。  
例: Monster オブジェクトとして扱うと、Monster クラスでは経験値の値を持たないので経験値の操作ができない  

このような場合は、具象クラスとしてキャスト(変換)するとスムーズに実装できます。  
余力のある方は、キャストの方法を調べてみましょう。
:::

## 4. 経験値を獲得する動作を実装する

続いて、経験値を得たときの動作を作成していきます。
経験値のメンバ変数を直接操作するのではなく、経験値取得を処理するメソッドを実装しておきます。  

なぜなら、経験値を獲得する場面では、複数の処理をまとめて行うことが想定されているからです。  
「経験値を獲得する」という処理を細かく分解してみると、以下のような動作が含まれていることがわかります。  

1. キャラクターのメンバ変数の経験値を増やす
2. 経験値の増加後、値が一定を超えているかを判定する
3. 経験値が一定を超えている場合、レベルアップさせる

経験値の値を変更し、一定の値を超えているかを判定する必要があり、単に経験値のメンバ変数を増加させるだけでは不十分です。  
そのため、上記の1～3の処理をまとめて、新しく「経験値を獲得する」という処理を作成したほうが、役割分担ができます。  

まずは、経験値の値を増やすことができるようにしていきます。上記の1の動作です。  
新しく作った「経験値を獲得する」というメソッドに、経験値の値を増やす処理を記述しておきましょう。  
また、経験値を獲得するメソッドの引数として、「獲得する経験値の値」をint型で設定しましょう。  

上記の2, 3 の動作は、後ほど実装していきます。

:::info
あるメソッドから、別のメソッドを呼び出すことができます。
今回で言えば、「経験値を獲得する」のメソッドの中で、この後作成する「レベルを上昇させる」というメソッドを呼び出すことができます。
:::

## 5. 戦闘終了時に、「経験値を獲得する」という処理を追加する

次に、戦闘終了の場面と、経験値を得る機能をつなげます。  
MyMonster オブジェクトの、「経験値を獲得する」メソッドを呼び出します。  
指定した分だけ、MyMonster オブジェクトのメンバ変数の経験値が増やせているか、確認しておきましょう。  

## 6. レベルを上昇させる機能を実装する

次に、レベルアップした場合の処理を作成します。こちらも、あたらしくメンバメソッドを作成していきます。  
レベルアップ処理には、以下の動作を含めます。  

1. キャラクターのレベルの数値を増やす
2. キャラクターの各ステータスの値を増やす
3. キャラクターの経験値の値を変更する（たとえば、0に戻すなど）

ステータスの変更量や、経験値の値をどのように扱うかは、各自で考えて決めてみてください。

## 7. 「経験値を獲得する」メソッドと、「レベルを上昇させる」メソッドをつなげる

ここまでくれば、あとは簡単です。「経験値を上昇させる」メソッドで必要な動作のうち、2～3を追加していきます。  
経験値増加後の値を判定し、一定以上であれば、「レベルを上昇させる」メソッドを呼び出してください。  

## 8. 動作の確認

戦闘後に経験値を獲得し、レベルを上昇させることができるようになったら、動作に問題がないかを確かめていきます。  
すくなくとも、以下のパターンでエラーが起こらないことを確認してください。

:white_check_mark: 戦闘から逃げた場合は、経験値が増えていないこと  
:white_check_mark: レベルが複数回上昇できること
